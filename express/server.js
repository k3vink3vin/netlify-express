'use strict';
const express = require('express');
const serverless = require('serverless-http');
const bodyParser = require('body-parser');
const cors = require('cors')
const path = require('path');

const app = express();
const router = express.Router();

router.get('/', (req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/html' });
  res.write('<h1>Hello from Express.js!</h1>');
  res.end();
});

router.get('/foo', async (req, res) => {
  console.log("New foo requested");
  res.send({foo: 'bar'});
});

router.get('/dev/jwks', async (req, res) => {
  console.log("dev jwks requested");
  res.send({
    "keys": [
      {
        "kty": "EC",
        "kid": "ABC123",
        "x5c": [
          "MIIBbzCCASGgAwIBAgIUDIXWPASo8ANBTs2u2EAt+407gTUwBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjMwNjIyMjIyOTExWhcNMjYwMzE4MjIyOTExWjApMScwJQYDVQQDDB5kaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUwKjAFBgMrZXADIQAd85R/qcYDIBowLGQyMtxL9otCBAgyeS1QkQNFwVWfAKNjMGEwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUQa/9C0hNQYTfpnkX/y71WIvNG/YwHwYDVR0jBBgwFoAU2HSLIwyn6rQ0iSDYOYUXUUnTnJIwCwYDVR0PBAQDAgGmMAUGAytlcANBADDu6RtM7Miue+BOhJV34uo7eT6amOgxTIxizFzd4IOXHdddlM+9xurGVZ0B197W7f0i4kKB4XV4np6//UjgtQc=",
          "MIIBBDCBtwIUaP+stH67Krd8Og0iQbfxheWkilIwBQYDK2VwMCkxJzAlBgNVBAMMHmRpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZTAeFw0yMzA2MjIyMjI5MTFaFw0yNDA2MjEyMjI5MTFaMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOmxlYWYwKjAFBgMrZXADIQBAFmEdGuCahcgAVi3fTaVVMoE9G5vd2Id4LygnTdYofjAFBgMrZXADQQC6a5X+VxFcIwn+/4vQXOqo+stPYaI5iwyf5PRSy4zvLQKLW8WyfOpm95iK67AikD9DSzsTfSEfnJOra4vgIZkM"
        ]
      },
      {
        "x5c": [
          "MIIFWzCCA0MCFFXLR4r+5kl+tKk9xZmYpKu61JxpMA0GCSqGSIb3DQEBCwUAMG0xCzAJBgNVBAYTAlVTMQ8wDQYDVQQIDAZPcmVnb24xETAPBgNVBAcMCFBvcnRsYW5kMRUwEwYDVQQKDAxEaWdpbWFyYyBJbmMxIzAhBgNVBAMMGmRldi5kbXJjLmlvOmxpY2Vuc2luZzpyb290MB4XDTIxMDkyMzA0MDM0NVoXDTI0MDkyMjA0MDM0NVowZzELMAkGA1UEBhMCVVMxDzANBgNVBAgMBk9yZWdvbjERMA8GA1UEBwwIUG9ydGxhbmQxFTATBgNVBAoMDERpZ2ltYXJjIEluYzEdMBsGA1UEAwwUZG1yYy5pbzpsYnJva2VyLTIwMjAwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDwi2+4jvwO4gupzmbnKXd8tn4KEg/8h2pv24v8QesQu0w347fa8QT7rafSpfJUA51v3qORVa7dGR7gNdpdYVGLrlOLPFYC7z38UVXk17be4fJVMt46HjlC7T6qzAQXbKzL0UhinTVpu3o1MpbPYYOHTllXXmpb+/SsGYDZAnPkaYdPDitis4i/eaV2I9ni2p8EcJuITzBKK/EDmRuqtVDLC4dC5nwqnJMPywKYw+nNRiZ9kQ6w+VzBqfc6at3mZdy45zcOT7lRSx5MuQVkPgK3VbJG0exH5J7gypFYtAKbZw6KLKVC7j6/LzO2SpGioyI3OrIQ1k6YBSuFB59AWlNJCQvVxzBLllCOkN97Yu9lH4drUc4GG4KWuYWa6WBGzNS1omnbc17d/RP4MSZ+uwh/DqyWTan2XKgELPfJVZ4U9uTjMhS+HLoUEt6syh7qym+r+/qZdz2l872BA87dawa9Bml1GLAjG1qK41/BEBFaaNtxbYUsx6dvaAMXDazs8aE2CDgrBB2IIOAf+qMeXw/vrGf4IdtDhCEXeWtPdDy3jiOp6QaYn0rTkKbaVyoCSu8O1u7CHmgjyUoQZ2U9nMA61FN2cmP9BT6QklJndS8qOrptPMs82EilUeTzCT1uEwJhf8KBQEzCcnXfYROa3HbrUBrmHUn0Eya4t0J18MT8nwIDAQABMA0GCSqGSIb3DQEBCwUAA4ICAQAWSrLm/r4Rt+CPsQQZSMA0Q9nn+YTT7QfpQVrLDsebgdneSnZljP4Cv0uH7nh/rdcmr8Yy2C9nF6j9AXShZVFkTvtrr63Zc0b7lUrkNaV6RBDuAZMoNNIpX/apcsUTav+5PCmd8h0p0qgBAmf1xnvFSamrpwfNSVMglEw9ynlDybygnIedQKlmPYnM8e3Xfn4R6sSm3nJlBNiO/vO0NUO2dnxtYIqP/qplQn3ES0NBKZBMISr+CUegtJSoC86de3ld//5ybHAfpCYtsFLfKuEVzSiBcqF/01cLcs4yKouPtNCdx3gESQn1iBSGJiX+EiVdiyKkmfOp/BLOJ7rvI8FxVwen+4svJz7J8tIwQNE0GTn5eAQNn+Ku3Q0kfCktVjvUFUjkWQj+Y5S0wse0pkw3RZnX+JsRkdp/0yvQAvelL2rYvAmBhhcRidJvXQKifpfx3xEyrn5yFi38jvRF1GADe3xSIM2SBU8WxJKXAjnBtbvZbzBf0tP+WK6yZDL7ezp6Q5FJWidSvy4MRlXr1U3zB3tNzUKVLLpE7gop6rKR5louBqB0p3GaWvsqkiSyZ5elayW3Ppgl5WxiHjWWw9Lm0vffcErfIzh/LP7oz+iRBWNiMNEVTdgZ7mTBlyrgMbeZl1SjlHJkRBnEeqvmmBxp+pXFvKt01D70OxTAuR0tPA=="
        ]
      },
      {
        "kty": "GBG",
        "mod" : 42
      }
    ]
  });
});

router.get('/int/jwks', async (req, res) => {
  console.log("int jwks requested");
  res.send(
    {"keys":[{"kid":"e5850235d365795e5c5197ac2ea0420926a31236","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDUzMDE1MjQyN1oXDTI1MDUzMDE1MjQyN1owITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhANyE4q9DpG95a6bQIt1xVeNWUOSo43ifahh7PelaRwGQo0IwQDAdBgNVHQ4EFgQUk4d06pa4Op3wXYKlbd6rSODrts8wHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAR00ZQPXksefxp/G76s4OhCvwvQ20f5qbTIubMGVv2BTWdOZNI76lZzbahyhzAvIMR30wBMoYS+WiUrKbAVwpBA=="]},{"kid":"266fdcca7a2110a24fbc527a0a98850d112fe6bd","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDUzMDE1MjMyNFoXDTI1MDUzMDE1MjMyNFowITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhAHQQkHBQTyAWDN+nQLvIQFdMSEX95/pPEKf96jl6Y6m0o0IwQDAdBgNVHQ4EFgQU7li7Peo6HqF9NfATjuHrAQv/h18wHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAtUUw4zxdC3gPrNfXPJt9Mot6rN4yl4d3DffhW5Dj8T0CYs9BtTfi+TOMvP60djS4ZO/sn5E5rVjGIE9dV7wbCA=="]}],"SkipUnresolvedJsonWebKeys":true}
  );
});

router.get('/uat/jwks', async (req, res) => {
  console.log("int jwks requested");
  res.send(
    {"keys":[{"kid":"04bdc0cac09da672e7eba67b080ba1c9c0cff2cf","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDUzMDIwNDk0OFoXDTI1MDUzMDIwNDk0OFowITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhAPN1C9x4bA7BETS6XDp62Mv6xGvW6n6rSvzPEq5Xdc/Ro0IwQDAdBgNVHQ4EFgQUM6/Iiz15hKdXgdzVklu3aR9MCpgwHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAH68fJnn1iMaDmmqArI4rsrlHgy17hW7ijZU5UJTz3M2t9k4CJNbBx2Xt2cQgXpGFHktFUjBUPVTIIpRmJo5NDQ=="]},{"kid":"4c905d234161fd8446b107fdb445dd1fbae4a40d","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBCDCBuwIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTIzMDYyMTE1MDI0OFoXDTI0MDYyMDE1MDI0OFowIDEeMBwGA1UEAwwVZGlnaW1hcmMuY29tOmRzaW5sZWFmMCowBQYDK2VwAyEAv1oV1vqBAhMea9+ve27oK0rb3XK/9dOzBB2pkVzW2LEwBQYDK2VwA0EAq9kanpy1/Q7Jl5CNV7hpkCS+iEh4ohvdpKISV7qhBCHrDBcsMmkuTcGTlDJmCGaY9ZyDx8qnls4K35yN538aCA=="]}],"SkipUnresolvedJsonWebKeys":true}
  );
});

router.get('/stg/jwks', async (req, res) => {
  console.log("int jwks requested");
  res.send(
    {"keys":[{"kid":"10fbbdbad60578b977ed401159f7d06f69dcfcf2","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDUzMDIyMjA0M1oXDTI1MDUzMDIyMjA0M1owITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhANO2m28LPUxhPe3wCse6+qrNNCu+zGFkyNSe7pcPwr1fo0IwQDAdBgNVHQ4EFgQU0d9WYfDJd81V3t7uXyITKshrxXkwHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EA3ZpnxQw4zWgEp/NmhrhrgtUl/eWEywEfDve+MJLMf/4+3DInRfsfFKVM4KDHdvMbh+sIuTnP+BWHW/LZ34GFAw=="]},{"kid":"a2ab7f128d9a83c729129a388849991c4efce37b","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDUzMDIyMTExNloXDTI1MDUzMDIyMTExNlowITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhAD7c6TIBAc59we/j9mVneBayI33dPZJD3V1C5wfyJ7bHo0IwQDAdBgNVHQ4EFgQUsjuk+O2jpInTgbg2osmzJvn9iA0wHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAhrreYgXXRhTM30V41WpdioPriEti6OSLKmhAiFaVwzFooYArUpzp+VebAKTEjt05Vy9rowTnYD1E6rdoWy93Cw=="]}],"SkipUnresolvedJsonWebKeys":true}
  );
});

router.get('/pre/jwks', async (req, res) => {
  console.log("pre jwks requested");
  res.send(
    {"keys":[{"kid":"dd02ed66fe2e394e1c5d54e7fe46213e5c5706cc","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MTExMzIwMDE0NVoXDTI1MTExMzIwMDE0NVowITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhAA1qfFazIWIfVK3i2WoN3f65lHd5dZ8m5I0De8590TPGo0IwQDAdBgNVHQ4EFgQUXgmltoW0vs6CibKQYzN2nQ3M8/AwHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAAw9xolq78g+Wb11VNfPjmqe2Llx4cn8qpexxJYxn0EbbJmggH+DMBYnfThr5HXrqlVFVWOmpJPy2RSSw92fBDQ=="]},{"kid":"af10b62ad7b2dc053158ee3b91e9d6c64d0e83b2","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MTExMzIwMDExMFoXDTI1MTExMzIwMDExMFowITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhAG4qCOF8J/oQ2b1q2stQCgTzedcw3gglxzgoPZgF8sLPo0IwQDAdBgNVHQ4EFgQU9z35PONLcaiRVIT6/Z5BJtnN5bEwHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EA9E2HRCIDOYFTrNpDRLMIt47BpmF7OVhJZ7x6OPTQxIXZSB/i5z+qfhzVl1FDiOUri4wmZv4yeQsP3H3vpBaqAQ=="]}],"SkipUnresolvedJsonWebKeys":true}
  );
});

router.get('/prod/jwks', async (req, res) => {
  console.log("prod jwks requested");
  res.send(
    {"keys":[{"kid":"22be545891ecc1fcde758da3e541b52a43f13790","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBUzCCAQWgAwIBAgIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTI0MDYxMDIwMTEyN1oXDTI1MDYxMDIwMTEyN1owITEfMB0GA1UEAwwWZGlnaW1hcmMuY29tOmRzaW46bGVhZjAqMAUGAytlcAMhANk1659+/NVYhKa0QaUSxUred7zrV9vi9eoaKHdWfaWao0IwQDAdBgNVHQ4EFgQUdEpQCzMY9oYQl8lE0Xjdva68/ZQwHwYDVR0jBBgwFoAU3AKsMJMSXyKCMree6l4NkilNJKwwBQYDK2VwA0EAe0u5hL+V4hu7yaVyJNn8enWBzEWX4spchOtHCBEVmZhiRYAWuEf3o0KPZQBKCoLyyOF//+8rFTNGBBslvRUYAA=="]},{"kid":"91ef71deb24845ab35c172b532324ca822c1efc0","kty":"EC","x5c":["MIIBdDCCASagAwIBAgIUWXXi6D7zeRaGdldhUgAGxAmBNAowBQYDK2VwMCExHzAdBgNVBAMMFmRpZ2ltYXJjLmNvbTpkc2luOnJvb3QwHhcNMjIwNTIzMjEyNDQ1WhcNMjUwOTA0MjEyNDQ1WjAuMSwwKgYDVQQDDCNkaWdpbWFyYy5jb206ZHNpbjppbnRlcm1lZGlhdGUtMjAyMjAqMAUGAytlcAMhANRWq7lTa0UqCRSJN0dSfO4m10SfllV0Ns6rhtTZqInwo2MwYTASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBTcAqwwkxJfIoIyt57qXg2SKU0krDAfBgNVHSMEGDAWgBQ72MFYLq58YD5b0HSMXlShPkH7XTALBgNVHQ8EBAMCAaYwBQYDK2VwA0EAf6/IWxrXHYQsMOuVUQVxTVONwz1n+sbrWYLxfoEq+SCEbiI+hwfydR/aNfSBpSQN+CB13Wbv9oC/wjwGj2stBA==","MIIBCDCBuwIUW+Gy4vfVi5nGaTN5dXyy/cVaT8EwBQYDK2VwMC4xLDAqBgNVBAMMI2RpZ2ltYXJjLmNvbTpkc2luOmludGVybWVkaWF0ZS0yMDIyMB4XDTIzMDYyMjIyMDgxNFoXDTI0MDYyMTIyMDgxNFowIDEeMBwGA1UEAwwVZGlnaW1hcmMuY29tOmRzaW5sZWFmMCowBQYDK2VwAyEApPgyo1bF3fznF4HdPzwjjOvrsTSYH7IPjKC74vvvp7AwBQYDK2VwA0EApj2ek834rtj6m91boo0aPC3c6jj8J68vRVUSLI6E+OjBpAXBcDZNFu3lo8Bvxir+VguhzTvgzWm5y5Typ7whCA=="]}],"SkipUnresolvedJsonWebKeys":true}
  );
});

app.use(cors());
app.use(bodyParser.json());
app.use('/.netlify/functions/server', router);  // path must route to lambda
app.use('/', (req, res) => res.sendFile(path.join(__dirname, '../index.html')));

module.exports = app;
module.exports.handler = serverless(app);
